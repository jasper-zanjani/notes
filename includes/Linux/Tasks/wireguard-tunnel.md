#### Wireguard tunnel
:   
    === ":material-redhat: Red Hat"

        ```sh
        dnf install wireguard-tools
        ```

    === ":material-ubuntu: Ubuntu"

        ```sh
        apt install wireguard
        ```

    Successful installation can be confirmed by running the following, which should produce no output (and no error) on success.
    ```sh
    sudo modprobe wireguard
    ```

    The first step in [creating a Wireguard tunnel](https://www.youtube.com/watch?v=88GyLoZbDNw) is to create a private key on each endpoint of the tunnel.
    The **genkey** subcommand creates a 44-character base64 encoded key ending in `=` which can be redirected to a file.
    If the file will be world-readable, the utility will ask you to change the umask.
    ```sh
    wg genkey # ▓▓░░░▓░▒▓▒▓▒░▓░▒░▓░▒▒░▓░▓░▒░▒▓▒▒▒░░▒▒░░░▒▒▓▓=
    ```

    The public key can be generated by piping the private key from STDIN or from the file.
    ```sh
    wg pubkey private > public
    wg genkey | tee private | wg pubkey > public
    ```

    Then a Wireguard interface is created, typically named **wg0**, using network management utilities.
    ```sh
    ip link add wg0 type wireguard
    ```

    An IP address is assigned to that interface, to be used within the tunnel:
    ```sh
    ip addr add 10.0.0.1/24 dev wg0
    ```

    Now the private key is associated with the interface:
    ```sh
    wg set wg0 private-key ~/.config/wireguard/private
    ```

    Finally, the interface is brought up:
    ```sh
    ip link set wg0 up
    ```

    The public key of the peer is now associated with the Wireguard interface and the public IP and port of the other endpoint are specified.
    ```sh
    wg set wg0 peer $PUBKEY allowed-ips 10.0.0.2/32 endpoint $IP
    ```

    The tunnel is dismantled by removing the interface.
    ```sh
    ip link delete wg0
    ```

    Alternatively, many of these steps can be consolidated into creating a config for the Wireguard interface at **/etc/wireguard/wg0.conf** with the following contents:
    ```ini
    [Interface]
        PrivateKey = ▓▓░░░▓░▒▓▒▓▒░▓░▒░▓░▒▒░▓░▓░▒░▒▓▒▒▒░░▒▒░░░▒▒▓▓=
        Address = 10.0.0.1/24
        PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
        PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
        ListenPort = 51820

    [Peer]
        PublicKey = ▓▒▓▒▓▓░▓▒▒░░▒▒▒▓▒░▒▓▒░▒▒▓▒░▒░░░░▒░▒▒▒░░▒▒▓░▒=
        AllowedIps = 10.0.0.2/32
        Endpoint = 123.45.67.89:51820
    ```

    Then to bring it up quickly:
    ```sh
    wg-quick up wg0
    ```

    The same utility can be used to teardown the tunnel
    ```sh
    wg-quick down wg0
    ```

    